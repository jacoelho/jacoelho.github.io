<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="map[name:Jose Coelho]"><meta name=description content="Ramblings about software engineering"><meta name=keywords content="go,golang,kubernetes,ansible,chef,kafka,docker,containers"><link rel=canonical href=https://www.jacoelho.com/blog/2023/09/structured-logging-slog/><title>structured logging: slog :: Posts</title><link rel=stylesheet href=https://www.jacoelho.com/css/main.min.119ac2c18046a4ef9e7705b9cd71e1fc8cbe5a5139a1234cfdae109d1baedb3c.css integrity="sha256-EZrCwYBGpO+edwW5zXHh/Iy+WlE5oSNM/a4QnRuu2zw=" crossorigin=anonymous><meta itemprop=name content="structured logging: slog"><meta itemprop=description content="Event logging is one of the three pillars of observability (traces and metrics being the other two).
A log entry is a timestamped record about the application’s activity, which can be used for troubleshooting, monitoring or auditing purposes.
Logs may have different formats:
unstructured or plain text: similar to print statements, free-form text semi-structured: some values have a structure and the remaining data free-form structured: there is a well-defined and consistent format, such as: W3C Log Format, NCSA Log Format, Key/Value Pair, CSV or JSON, among others. Structured logs can be easily machine parsed, which simplifies analytics, filtering and aggregation. This article is a non-exhaustive walkthrough of logging in Go."><meta itemprop=datePublished content="2023-09-11T10:00:00+00:00"><meta itemprop=dateModified content="2023-09-11T10:00:00+00:00"><meta itemprop=wordCount content="1145"><meta itemprop=keywords content="Go,Golang,Logging,Slog"><meta property="og:url" content="https://www.jacoelho.com/blog/2023/09/structured-logging-slog/"><meta property="og:site_name" content="Posts"><meta property="og:title" content="structured logging: slog"><meta property="og:description" content="Event logging is one of the three pillars of observability (traces and metrics being the other two).
A log entry is a timestamped record about the application’s activity, which can be used for troubleshooting, monitoring or auditing purposes.
Logs may have different formats:
unstructured or plain text: similar to print statements, free-form text semi-structured: some values have a structure and the remaining data free-form structured: there is a well-defined and consistent format, such as: W3C Log Format, NCSA Log Format, Key/Value Pair, CSV or JSON, among others. Structured logs can be easily machine parsed, which simplifies analytics, filtering and aggregation. This article is a non-exhaustive walkthrough of logging in Go."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-09-11T10:00:00+00:00"><meta property="article:modified_time" content="2023-09-11T10:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="structured logging: slog"><meta name=twitter:description content="Event logging is one of the three pillars of observability (traces and metrics being the other two).
A log entry is a timestamped record about the application’s activity, which can be used for troubleshooting, monitoring or auditing purposes.
Logs may have different formats:
unstructured or plain text: similar to print statements, free-form text semi-structured: some values have a structure and the remaining data free-form structured: there is a well-defined and consistent format, such as: W3C Log Format, NCSA Log Format, Key/Value Pair, CSV or JSON, among others. Structured logs can be easily machine parsed, which simplifies analytics, filtering and aggregation. This article is a non-exhaustive walkthrough of logging in Go."><meta property="article:published_time" content="2023-09-11 10:00:00 +0000 UTC"><meta property="article:section" content="go"><meta property="article:section" content="golang"><meta property="article:section" content="logging"><meta property="article:section" content="slog"></head><body><header class=header><div class=container><div class=header-inner><a href=https://www.jacoelho.com/ class=logo>Jose Coelho</a><nav class=nav><ul class=menu><li class=menu-item><a href=https://www.jacoelho.com/about/>About</a></li></ul><button class=menu-trigger aria-label="Toggle menu" aria-expanded=false>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</button>
<button class=theme-toggle aria-label="Toggle theme">
<svg class="theme-icon-light" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
<svg class="theme-icon-dark" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
</button>
<a href=https://www.jacoelho.com/index.xml class=rss-link target=_blank rel=noopener aria-label=RSS><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></nav></div></div></header><div class=container><div class=content><main class=post><article><header class=post-header><h1 class=post-title>structured logging: slog</h1><div class=post-meta><span class=post-meta-item><time datetime=2023-09-11>September 11, 2023</time></span></div></header><div class=post-content><p>Event logging is one of the three pillars of observability (traces and metrics being the other two).</p><p>A log entry is a timestamped record about the application&rsquo;s activity, which can be used for troubleshooting, monitoring or auditing purposes.</p><p>Logs may have different formats:</p><ul><li>unstructured or plain text: similar to print statements, free-form text</li><li>semi-structured: some values have a structure and the remaining data free-form</li><li>structured: there is a well-defined and consistent format, such as: <a href=https://www.w3.org/TR/WD-logfile.html>W3C Log Format</a>, <a href=https://en.wikipedia.org/wiki/Common_Log_Format>NCSA Log Format</a>, Key/Value Pair, CSV or JSON, among others. Structured logs can be easily machine parsed, which simplifies analytics, filtering and aggregation.</li></ul><p>This article is a non-exhaustive walkthrough of logging in Go.</p><h2 id=unstructured-logging>Unstructured logging</h2><p>The <a href=https://pkg.go.dev/log>log</a> package allows the unstructured log writing:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;log&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;os&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>logger</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>log</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stderr</span><span class=p>,</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>log</span><span class=p>.</span><span class=nx>LstdFlags</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>logger</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Hello world!&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Where <a href=https://pkg.go.dev/log#pkg-constants>LstdFlags</a> is a subset of the semi-structured flags available:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>const</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Ldate</span><span class=w>         </span><span class=p>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=kc>iota</span><span class=w>     </span><span class=c1>// the date in the local time zone: 2009/01/23</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Ltime</span><span class=w>                         </span><span class=c1>// the time in the local time zone: 01:23:23</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Lmicroseconds</span><span class=w>                 </span><span class=c1>// microsecond resolution: 01:23:23.123123.  assumes Ltime.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Llongfile</span><span class=w>                     </span><span class=c1>// full file name and line number: /a/b/c/d.go:23</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Lshortfile</span><span class=w>                    </span><span class=c1>// final file name element and line number: d.go:23. overrides Llongfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>LUTC</span><span class=w>                          </span><span class=c1>// if Ldate or Ltime is set, use UTC rather than the local time zone</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>Lmsgprefix</span><span class=w>                    </span><span class=c1>// move the &#34;prefix&#34; from the beginning of the line to before the message</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>LstdFlags</span><span class=w>     </span><span class=p>=</span><span class=w> </span><span class=nx>Ldate</span><span class=w> </span><span class=p>|</span><span class=w>  </span><span class=nx>Ltime</span><span class=w> </span><span class=c1>// initial values for the standard logger</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>Although there are some structured flags available, most logging still happens in free-form format.</p><h2 id=structured-logging>Structured logging</h2><p>There are multiple libraries in Go that support structured logging, one of the most used is <a href=https://github.com/sirupsen/logrus>logrus</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>log</span><span class=w> </span><span class=s>&#34;github.com/sirupsen/logrus&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>log</span><span class=p>.</span><span class=nf>SetFormatter</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>log</span><span class=p>.</span><span class=nx>JSONFormatter</span><span class=p>{})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>log</span><span class=p>.</span><span class=nf>WithFields</span><span class=p>(</span><span class=nx>log</span><span class=p>.</span><span class=nx>Fields</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=s>&#34;animal&#34;</span><span class=p>:</span><span class=w> </span><span class=s>&#34;walrus&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}).</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;A walrus appears&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// outputs:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// {&#34;animal&#34;:&#34;walrus&#34;,&#34;level&#34;:&#34;info&#34;,&#34;msg&#34;:&#34;A walrus appears&#34;,&#34;time&#34;:&#34;2023-01-01T09:00:00+01:00&#34;}</span><span class=w>
</span></span></span></code></pre></div><p>Logging can impact the application performance, specially if the logging overhead starts to be noticeable.</p><p>There are two libraries in the ecosystem with performance as a main feature: <a href=https://github.com/uber-go/zap>zap</a> and <a href=https://github.com/rs/zerolog>zerolog</a>.</p><p>According to the benchmarks provided by the zap project:</p><table><thead><tr><th style=text-align:left>Package</th><th style=text-align:center>Time</th><th style=text-align:center>Time % to zap</th><th style=text-align:center>Objects Allocated</th></tr></thead><tbody><tr><td style=text-align:left>&#9889; zap</td><td style=text-align:center>1744 ns/op</td><td style=text-align:center>+0%</td><td style=text-align:center>5 allocs/op</td></tr><tr><td style=text-align:left>&#9889; zap (sugared)</td><td style=text-align:center>2483 ns/op</td><td style=text-align:center>+42%</td><td style=text-align:center>10 allocs/op</td></tr><tr><td style=text-align:left>zerolog</td><td style=text-align:center>918 ns/op</td><td style=text-align:center>-47%</td><td style=text-align:center>1 allocs/op</td></tr><tr><td style=text-align:left>go-kit</td><td style=text-align:center>5590 ns/op</td><td style=text-align:center>+221%</td><td style=text-align:center>57 allocs/op</td></tr><tr><td style=text-align:left>slog</td><td style=text-align:center>5640 ns/op</td><td style=text-align:center>+223%</td><td style=text-align:center>40 allocs/op</td></tr><tr><td style=text-align:left>apex/log</td><td style=text-align:center>21184 ns/op</td><td style=text-align:center>+1115%</td><td style=text-align:center>63 allocs/op</td></tr><tr><td style=text-align:left>logrus</td><td style=text-align:center>24338 ns/op</td><td style=text-align:center>+1296%</td><td style=text-align:center>79 allocs/op</td></tr><tr><td style=text-align:left>log15</td><td style=text-align:center>26054 ns/op</td><td style=text-align:center>+1394%</td><td style=text-align:center>74 allocs/op</td></tr></tbody></table><p>Looking at the benchmark it is evident that logging can impact heavily both latency and memory/<a href=https://tip.golang.org/doc/gc-guide>gc</a> by several order of magnitude.</p><p>Using <code>zerolog</code> as an example, the API is still user-friendly:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>main</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;os&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;github.com/rs/zerolog&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>logger</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>zerolog</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stderr</span><span class=p>).</span><span class=nf>With</span><span class=p>().</span><span class=nf>Timestamp</span><span class=p>().</span><span class=nf>Logger</span><span class=p>()</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>logger</span><span class=p>.</span><span class=nf>Info</span><span class=p>().</span><span class=nf>Msg</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>)</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// outputs:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// {&#34;level&#34;:&#34;info&#34;,&#34;time&#34;:&#34;2023-01-01T09:00:00+01:00&#34;,&#34;message&#34;:&#34;hello world&#34;}</span><span class=w>
</span></span></span></code></pre></div><h2 id=abstraction>Abstraction</h2><p>Given the multiple structured logging libraries available, it is common practice to create an agnostic abstraction to avoid being tied to implementation specifics.</p><p>A starting point could be something like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>Logger</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nf>Info</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>msg</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>keysAndValues</span><span class=w> </span><span class=o>...</span><span class=kt>any</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nf>Error</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>msg</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>keysAndValues</span><span class=w> </span><span class=o>...</span><span class=kt>any</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=o>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Another option could be using <a href=https://github.com/go-logr/logr>logr</a>, which provides an API without being tied to a specific implementation and without dependencies.</p><p>The API is not an interface, but a concrete type for performance reasons:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>Logger</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>sink</span><span class=w>  </span><span class=nx>LogSink</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>level</span><span class=w> </span><span class=kt>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Where the <code>LogSink</code> looks similar to a hypothetical logging interface:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// LogSink represents a logging implementation.  End-users will generally not</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// interact with this type.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>type</span><span class=w> </span><span class=nx>LogSink</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nf>Info</span><span class=p>(</span><span class=nx>level</span><span class=w> </span><span class=kt>int</span><span class=p>,</span><span class=w> </span><span class=nx>msg</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>keysAndValues</span><span class=w> </span><span class=o>...</span><span class=kt>any</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Error logs an error, with the given message and key/value pairs as</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// context.  See Logger.Error for more details.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nf>Error</span><span class=p>(</span><span class=nx>err</span><span class=w> </span><span class=kt>error</span><span class=p>,</span><span class=w> </span><span class=nx>msg</span><span class=w> </span><span class=kt>string</span><span class=p>,</span><span class=w> </span><span class=nx>keysAndValues</span><span class=w> </span><span class=o>...</span><span class=kt>any</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// WithValues returns a new LogSink with additional key/value pairs.  See</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// Logger.WithValues for more details.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nf>WithValues</span><span class=p>(</span><span class=nx>keysAndValues</span><span class=w> </span><span class=o>...</span><span class=kt>any</span><span class=p>)</span><span class=w> </span><span class=nx>LogSink</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>In practice, using <a href=https://github.com/rs/zerolog>zerolog</a> as the <code>LogSink</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;os&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;github.com/go-logr/zerologr&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;github.com/rs/zerolog&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>zl</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>zerolog</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stderr</span><span class=p>).</span><span class=nf>With</span><span class=p>().</span><span class=nf>Timestamp</span><span class=p>().</span><span class=nf>Logger</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>logger</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>zerologr</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>zl</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>logger</span><span class=p>.</span><span class=nf>WithValues</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>,</span><span class=w> </span><span class=mi>42</span><span class=p>).</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// alternative</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>logger</span><span class=p>.</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;a&#34;</span><span class=p>,</span><span class=w> </span><span class=mi>42</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// outputs:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// {&#34;level&#34;:&#34;info&#34;,&#34;a&#34;:42,&#34;v&#34;:0,&#34;time&#34;:&#34;2023-01-01T09:00:00+01:00&#34;,&#34;message&#34;:&#34;hello world&#34;}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// {&#34;level&#34;:&#34;info&#34;,&#34;v&#34;:0,&#34;a&#34;:42,&#34;time&#34;:&#34;2023-01-01T09:00:00+01:00&#34;,&#34;message&#34;:&#34;hello world&#34;}</span><span class=w>
</span></span></span></code></pre></div><h3 id=slog>slog</h3><p>The <a href=https://pkg.go.dev/log/slog>slog</a> package introduces structured logging as a first class package in the standard library in Go version 1.21.0.</p><p>The <a href=https://go.googlesource.com/proposal/+/master/design/56345-structured-logging.md>design document</a> is a good starting point on the decisions and trade-offs.</p><p>The library provides different ways to log:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;context&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;log/slog&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;os&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>logger</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>slog</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>slog</span><span class=p>.</span><span class=nf>NewJSONHandler</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stdout</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>logger</span><span class=p>.</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;a&#34;</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// alternative</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>logger</span><span class=p>.</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>slog</span><span class=p>.</span><span class=nf>Int</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// alternative</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>logger</span><span class=p>.</span><span class=nf>LogAttrs</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>slog</span><span class=p>.</span><span class=nx>LevelInfo</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=s>&#34;hello world&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>slog</span><span class=p>.</span><span class=nf>Int</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// outputs:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// {&#34;time&#34;:&#34;2023-01-01T09:00:00.000000+01:00&#34;,&#34;level&#34;:&#34;INFO&#34;,&#34;msg&#34;:&#34;hello world&#34;,&#34;a&#34;:5}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// {&#34;time&#34;:&#34;2023-01-01T09:00:00.000000+01:00&#34;,&#34;level&#34;:&#34;INFO&#34;,&#34;msg&#34;:&#34;hello world&#34;,&#34;a&#34;:5}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// {&#34;time&#34;:&#34;2023-01-01T09:00:00.000000+01:00&#34;,&#34;level&#34;:&#34;INFO&#34;,&#34;msg&#34;:&#34;hello world&#34;,&#34;a&#34;:5}</span><span class=w>
</span></span></span></code></pre></div><p>The <a href=https://pkg.go.dev/log/slog#LogValuer>LogValuer</a> interface makes for an interesting addition:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// A LogValuer is any Go value that can convert itself into a Value for logging.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//  
</span></span></span><span class=line><span class=cl><span class=c1>// This mechanism may be used to defer expensive operations until they are  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// needed, or to expand a single value into a sequence of components.  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>type</span><span class=w> </span><span class=nx>LogValuer</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nf>LogValue</span><span class=p>()</span><span class=w> </span><span class=nx>Value</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Implementing the interface:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>main</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;log/slog&#34;</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;os&#34;</span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;time&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>type</span><span class=w> </span><span class=nx>expensive</span><span class=w> </span><span class=kd>struct</span><span class=p>{</span><span class=w> </span><span class=nx>arg</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=p>}</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>e</span><span class=w> </span><span class=nx>expensive</span><span class=p>)</span><span class=w> </span><span class=nf>LogValue</span><span class=p>()</span><span class=w> </span><span class=nx>slog</span><span class=p>.</span><span class=nx>Value</span><span class=w> </span><span class=p>{</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>slog</span><span class=p>.</span><span class=nf>AnyValue</span><span class=p>(</span><span class=nf>computeExpensiveValue</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>arg</span><span class=p>))</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>computeExpensiveValue</span><span class=p>(</span><span class=nx>arg</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=w> </span><span class=kt>any</span><span class=w> </span><span class=p>{</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>10</span><span class=p>)</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>arg</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>logger</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>slog</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>slog</span><span class=p>.</span><span class=nf>NewJSONHandler</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stdout</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=nx>slog</span><span class=p>.</span><span class=nx>HandlerOptions</span><span class=p>{</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=nx>Level</span><span class=p>:</span><span class=w> </span><span class=nx>slog</span><span class=p>.</span><span class=nx>LevelInfo</span><span class=p>,</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}))</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>start</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>()</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>logger</span><span class=p>.</span><span class=nf>Debug</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;a&#34;</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=s>&#34;b&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>expensive</span><span class=p>{</span><span class=mi>5</span><span class=p>})</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>logger</span><span class=p>.</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;done&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;took_seconds&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nf>Since</span><span class=p>(</span><span class=nx>start</span><span class=p>).</span><span class=nf>Seconds</span><span class=p>())</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// outputs:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// {&#34;time&#34;:&#34;2023-01-01T09:00:00.000000+01:00&#34;,&#34;level&#34;:&#34;INFO&#34;,&#34;msg&#34;:&#34;done&#34;,&#34;took_seconds&#34;:0.000001083}</span><span class=w>
</span></span></span></code></pre></div><p>In this case only <code>Info</code> or above is logged, the <code>computeExpensiveValue</code> is not called.</p><p>Another use case for the <code>LogValuer</code> is redacting sensible information:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=nx>Token</span><span class=p>)</span><span class=w> </span><span class=nf>LogValue</span><span class=p>()</span><span class=w> </span><span class=nx>slog</span><span class=p>.</span><span class=nx>Value</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=nx>slog</span><span class=p>.</span><span class=nf>StringValue</span><span class=p>(</span><span class=s>&#34;REDACTED&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>At <code>slog</code> core, the <a href=https://pkg.go.dev/log/slog#Handler>Handler</a> interface log records produced by a <code>Logger</code> (comments omitted for brevity):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>Handler</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nf>Enabled</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>Level</span><span class=p>)</span><span class=w> </span><span class=kt>bool</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nf>Handle</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span><span class=w> </span><span class=nx>Record</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nf>WithAttrs</span><span class=p>(</span><span class=nx>attrs</span><span class=w> </span><span class=p>[]</span><span class=nx>Attr</span><span class=p>)</span><span class=w> </span><span class=nx>Handler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nf>WithGroup</span><span class=p>(</span><span class=nx>name</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=nx>Handler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The <code>slog</code> package provides a <code>TextHandler</code> and <code>JSONHandler</code>, but a user can pick different implementations. It is possible to use <code>slog</code> with existing log libraries like <code>zap</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;context&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;log/slog&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;time&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;go.uber.org/zap&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;go.uber.org/zap/exp/zapslog&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;go.uber.org/zap/zapcore&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=nx>outputStderr</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;stdout&#34;</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>encoderConfig</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>zap</span><span class=p>.</span><span class=nf>NewProductionEncoderConfig</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>encoderConfig</span><span class=p>.</span><span class=nx>TimeKey</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&#34;time&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>encoderConfig</span><span class=p>.</span><span class=nx>EncodeTime</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>t</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Time</span><span class=p>,</span><span class=w> </span><span class=nx>enc</span><span class=w> </span><span class=nx>zapcore</span><span class=p>.</span><span class=nx>PrimitiveArrayEncoder</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>enc</span><span class=p>.</span><span class=nf>AppendString</span><span class=p>(</span><span class=nx>t</span><span class=p>.</span><span class=nf>Format</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>RFC3339Nano</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>cfg</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>zap</span><span class=p>.</span><span class=nx>Config</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>Level</span><span class=p>:</span><span class=w>            </span><span class=nx>zap</span><span class=p>.</span><span class=nf>NewAtomicLevelAt</span><span class=p>(</span><span class=nx>zap</span><span class=p>.</span><span class=nx>InfoLevel</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>Encoding</span><span class=p>:</span><span class=w>         </span><span class=s>&#34;json&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>EncoderConfig</span><span class=p>:</span><span class=w>    </span><span class=nx>encoderConfig</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>OutputPaths</span><span class=p>:</span><span class=w>      </span><span class=nx>outputStderr</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>ErrorOutputPaths</span><span class=p>:</span><span class=w> </span><span class=nx>outputStderr</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>zp</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>cfg</span><span class=p>.</span><span class=nf>Build</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>defer</span><span class=w> </span><span class=nx>zp</span><span class=p>.</span><span class=nf>Sync</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>logger</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>slog</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>zapslog</span><span class=p>.</span><span class=nf>NewHandler</span><span class=p>(</span><span class=nx>zp</span><span class=p>.</span><span class=nf>Core</span><span class=p>(),</span><span class=w> </span><span class=kc>nil</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>logger</span><span class=p>.</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;a&#34;</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// alternative</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>logger</span><span class=p>.</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>slog</span><span class=p>.</span><span class=nf>Int</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// alternative</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>logger</span><span class=p>.</span><span class=nf>LogAttrs</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>slog</span><span class=p>.</span><span class=nx>LevelInfo</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=s>&#34;hello world&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>slog</span><span class=p>.</span><span class=nf>Int</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// outputs:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// {&#34;level&#34;:&#34;info&#34;,&#34;time&#34;:&#34;2023-01-01T09:00:00.000000+01:00&#34;,&#34;msg&#34;:&#34;hello world&#34;,&#34;a&#34;:5}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// {&#34;level&#34;:&#34;info&#34;,&#34;time&#34;:&#34;2023-01-01T09:00:00.000000+01:00&#34;,&#34;msg&#34;:&#34;hello world&#34;,&#34;a&#34;:5}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// {&#34;level&#34;:&#34;info&#34;,&#34;time&#34;:&#34;2023-01-01T09:00:00.000000+01:00&#34;,&#34;msg&#34;:&#34;hello world&#34;,&#34;a&#34;:5}</span><span class=w>
</span></span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>Writing structure logs in Go was massively simplified with the introduction of the <code>log/slog</code> package, with the advantage of removing the need for external dependencies.</p><p>The usage of packages like <code>logr</code> or creating custom logging interfaces is less relevant, given it is easier to create <code>slog</code> handlers.</p><p>The <code>slog</code> performance according to the zap project benchmarks is in a good enough place, although there is room for using zap or zerolog if performance and latency are critical.</p><p>Go &ldquo;batteries included philosophy has therefore improved with the addition of <code>slog</code>.</p></div><div class=post-categories><a href=https://www.jacoelho.com/categories/go class=category>go</a>
<a href=https://www.jacoelho.com/categories/golang class=category>golang</a>
<a href=https://www.jacoelho.com/categories/logging class=category>logging</a>
<a href=https://www.jacoelho.com/categories/slog class=category>slog</a></div></article></main></div></div><footer class=footer><div class=container><div class=footer-content><span>&copy; 2025 Jose Coelho</span></div></div></footer><script src=https://www.jacoelho.com/js/bundle.min.2868f841c78e77d7b473d034a52bb46f21b12eef84caba5767ed9a65576ecb3c.js integrity="sha256-KGj4QceOd9e0c9A0pSu0byGxLu+EyrpXZ+2aZVduyzw=" crossorigin=anonymous></script></body></html>