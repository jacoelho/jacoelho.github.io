<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="map[name:Jose Coelho]"><meta name=description content="Ramblings about software engineering"><meta name=keywords content="go,golang,kubernetes,ansible,chef,kafka,docker,containers"><link rel=canonical href=https://www.jacoelho.com/blog/2016/08/collectd-plugins-made-easy/><title>Collectd plugins made easy :: Posts</title><link rel=stylesheet href=https://www.jacoelho.com/css/main.min.119ac2c18046a4ef9e7705b9cd71e1fc8cbe5a5139a1234cfdae109d1baedb3c.css integrity="sha256-EZrCwYBGpO+edwW5zXHh/Iy+WlE5oSNM/a4QnRuu2zw=" crossorigin=anonymous><meta itemprop=name content="Collectd plugins made easy"><meta itemprop=description content="Collectd is a Unix daemon that collects, transfers and stores performance
data of computers and network equipment. The acquired data is meant to help
system administrators maintain an overview over available resources to detect
existing or looming bottlenecks.
Collectd provides a long list of
plugins available
out-of-box. However, if you need to collect additional metrics, one of the
easiest ways to do so is using the exec
plugin.
In order to use the exec plugin, create an Collectd configuration file:"><meta itemprop=datePublished content="2016-08-09T10:24:46+00:00"><meta itemprop=dateModified content="2016-08-09T10:24:46+00:00"><meta itemprop=wordCount content="302"><meta itemprop=keywords content="Collectd"><meta property="og:url" content="https://www.jacoelho.com/blog/2016/08/collectd-plugins-made-easy/"><meta property="og:site_name" content="Posts"><meta property="og:title" content="Collectd plugins made easy"><meta property="og:description" content="Collectd is a Unix daemon that collects, transfers and stores performance
data of computers and network equipment. The acquired data is meant to help
system administrators maintain an overview over available resources to detect
existing or looming bottlenecks.
Collectd provides a long list of
plugins available
out-of-box. However, if you need to collect additional metrics, one of the
easiest ways to do so is using the exec
plugin.
In order to use the exec plugin, create an Collectd configuration file:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2016-08-09T10:24:46+00:00"><meta property="article:modified_time" content="2016-08-09T10:24:46+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Collectd plugins made easy"><meta name=twitter:description content="Collectd is a Unix daemon that collects, transfers and stores performance
data of computers and network equipment. The acquired data is meant to help
system administrators maintain an overview over available resources to detect
existing or looming bottlenecks.
Collectd provides a long list of
plugins available
out-of-box. However, if you need to collect additional metrics, one of the
easiest ways to do so is using the exec
plugin.
In order to use the exec plugin, create an Collectd configuration file:"><meta property="article:published_time" content="2016-08-09 10:24:46 +0000 UTC"><meta property="article:section" content="collectd"></head><body><header class=header><div class=container><div class=header-inner><a href=https://www.jacoelho.com/ class=logo>Jose Coelho</a><nav class=nav><ul class=menu><li class=menu-item><a href=https://www.jacoelho.com/about/>About</a></li></ul><button class=menu-trigger aria-label="Toggle menu" aria-expanded=false>
<svg width="24" height="24"><use href="https://www.jacoelho.com/icons.svg#menu"/></svg>
</button>
<button class=theme-toggle aria-label="Toggle theme">
<svg class="theme-icon-light" width="20" height="20"><use href="https://www.jacoelho.com/icons.svg#sun"/></svg>
<svg class="theme-icon-dark" width="20" height="20"><use href="https://www.jacoelho.com/icons.svg#moon"/></svg>
</button>
<a href=https://www.jacoelho.com/index.xml class=rss-link target=_blank rel=noopener aria-label=RSS><svg width="20" height="20"><use href="https://www.jacoelho.com/icons.svg#rss"/></svg></a></nav></div></div></header><div class=container><div class=content><main class=post><article><header class=post-header><h1 class=post-title>Collectd plugins made easy</h1><div class=post-meta><span class=post-meta-item><time datetime=2016-08-09>August 9, 2016</time></span></div></header><div class=post-content><blockquote><p><strong>Collectd</strong> is a Unix daemon that collects, transfers and stores performance<br>data of computers and network equipment. The acquired data is meant to help<br>system administrators maintain an overview over available resources to detect<br>existing or looming bottlenecks.</p></blockquote><p><a href=https://collectd.org/>Collectd</a> provides a <a href=https://collectd.org/wiki/index.php/Table_of_Plugins>long list of<br>plugins</a> available<br>out-of-box. However, if you need to collect additional metrics, one of the<br>easiest ways to do so is using the <a href=https://collectd.org/wiki/index.php/Plugin:Exec>exec<br>plugin</a>.</p><p>In order to use the exec plugin, create an <em>Collectd</em> configuration file:</p><pre tabindex=0><code>LoadPlugin exec

&lt;Plugin exec&gt;
  Exec &#34;myuser:mygroup&#34; &#34;/path/to/another/binary&#34; &#34;arg0&#34; &#34;arg1&#34;
&lt;/Plugin&gt;
</code></pre><p>And a sample script “<em>/path/to/another/binary</em>” (extracted from the official<br>documentation):</p><pre tabindex=0><code>HOSTNAME=&#34;${COLLECTD_HOSTNAME:-localhost}&#34;
INTERVAL=&#34;${COLLECTD_INTERVAL:-60}&#34;

while sleep &#34;$INTERVAL&#34;; do
  VALUE=do_magic()
  echo &#34;PUTVAL \&#34;$HOSTNAME/exec-magic/gauge-magic_level\&#34; interval=$INTERVAL N:$VALUE&#34;
done
</code></pre><p>The most important bits are contained in the outputted message :</p><pre tabindex=0><code>PUTVAL &#34;$HOSTNAME/exec-magic/gauge-magic_level&#34; interval=$INTERVAL N:$VALUE
</code></pre><p>Where:</p><ol><li><em>exec-magic</em> is the plugin name.</li><li><em>magic_level</em> is the metric name.</li><li><em>gauge</em> is the data source type, according to <a href=https://collectd.org/wiki/index.php/Data_source>collectd<br>types</a>.</li><li><em>N:</em> is the abbreviation for “now” as defined in the <a href=https://collectd.org/wiki/index.php/Plugin:Exec>exec<br>plugin</a>.</li></ol><hr><h3 id=sample-plugin>Sample plugin</h3><p>Now, let’s create a simple <em>Collectd <em>plugin. In the example that follows I will<br>use <a href=https://golang.org/>Go</a></em>.</em></p><p>The main loop will run the metric collection in a scheduled fashion:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>main</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;flag&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=s>&#34;time&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kd>var</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>interval</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>flag</span><span class=p>.</span><span class=nf>Int</span><span class=p>(</span><span class=s>&#34;interval&#34;</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=s>&#34;time in seconds between collection&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=nx>ticker</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nf>NewTicker</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Duration</span><span class=p>(</span><span class=o>*</span><span class=nx>interval</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>for</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>select</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>case</span><span class=w> </span><span class=o>&lt;-</span><span class=nx>ticker</span><span class=p>.</span><span class=nx>C</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>go</span><span class=w> </span><span class=nf>collectMetric</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>And the collectMetric code:</p><pre tabindex=0><code>hostname, _ := os.Hostname()
value := someWork()

fmt.Printf(&#34;PUTVAL %s/my-plugin/gauge-my_metric interval=%d N:%s\n&#34;, hostname, interval, value)
</code></pre><p>Just compile it and use your favorite configuration management tool to upload<br>the plugin and configuration.</p><p>The purpose of this example was to demonstrate how to create a plugin. For<br>“<em>production-ready</em>” plugins I recommend using the official *Go<br>*<a href=https://github.com/collectd/go-collectd>library</a>.</p><p>Exec plugin is the simplest and fastest way to plug a custom metric collector<br>into <em>Collectd</em>.</p></div><div class=post-categories><a href=https://www.jacoelho.com/categories/collectd class=category>collectd</a></div></article></main></div></div><footer class=footer><div class=container><div class=footer-content><span>&copy; 2025 Jose Coelho</span></div></div></footer><script src=https://www.jacoelho.com/js/bundle.min.2868f841c78e77d7b473d034a52bb46f21b12eef84caba5767ed9a65576ecb3c.js integrity="sha256-KGj4QceOd9e0c9A0pSu0byGxLu+EyrpXZ+2aZVduyzw=" crossorigin=anonymous></script></body></html>