<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="map[name:Jose Coelho]"><meta name=description content="Ramblings about software engineering"><meta name=keywords content="go,golang,kubernetes,ansible,chef,kafka,docker,containers,index"><link rel=canonical href=https://www.jacoelho.com/blog/><title>Posts :: Posts</title><link rel=stylesheet href=https://www.jacoelho.com/css/main.min.6f3353616359b0fe4cfe1d29dc41b46980dd1459838e2e6175f34881197cc945.css integrity="sha256-bzNTYWNZsP5M/h0p3EG0aYDdFFmDji5hdfNIgRl8yUU=" crossorigin=anonymous><link rel=alternate type=application/rss+xml href=https://www.jacoelho.com/blog/index.xml title=Posts><meta itemprop=name content="Posts"><meta itemprop=description content="Ramblings about software engineering"><meta itemprop=datePublished content="2025-05-11T10:00:00+00:00"><meta itemprop=dateModified content="2025-05-11T10:00:00+00:00"><meta itemprop=keywords content="Index"><meta property="og:url" content="https://www.jacoelho.com/blog/"><meta property="og:site_name" content="Posts"><meta property="og:title" content="Posts"><meta property="og:description" content="Ramblings about software engineering"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Posts"><meta name=twitter:description content="Ramblings about software engineering"></head><body><header class=header><div class=container><div class=header-inner><a href=https://www.jacoelho.com/ class=logo>Jose Coelho</a><nav class=nav><button class=menu-trigger aria-label="Toggle menu" aria-expanded=false>
<svg width="24" height="24"><use href="https://www.jacoelho.com/icons.svg#menu"/></svg></button><div class=nav-menu><ul class=menu><li class=menu-item><a href=https://www.jacoelho.com/about/>About</a></li></ul><button class=theme-toggle aria-label="Toggle theme">
<svg class="theme-icon-light" width="20" height="20"><use href="https://www.jacoelho.com/icons.svg#sun"/></svg>
<svg class="theme-icon-dark" width="20" height="20"><use href="https://www.jacoelho.com/icons.svg#moon"/></svg>
</button>
<a href=https://www.jacoelho.com/index.xml class=rss-link target=_blank rel=noopener aria-label=RSS><svg width="20" height="20"><use href="https://www.jacoelho.com/icons.svg#rss"/></svg></a></div></nav></div></div></header><div class=container><div class=content><main class=posts><h1>Posts</h1><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2016/11/kafka-accelerating/>Kafka — Accelerating!</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2016-11-22>November 22, 2016</time></span></div><p class=post-summary><p>Quick tips and insights on how to make <a href=https://kafka.apache.org/>Apache Kafka</a><br>work faster!</p><h3 id=hardware>Hardware</h3><ul><li>CPU doesn&rsquo;t matter that much.</li><li>Memory helps a lot (a lot) in performance.</li><li>SSDs are not required, since most operations are sequential read and writes.</li><li>If possible run in <a href=https://www.ibm.com/blogs/cloud-computing/2014/07/bare-metal-vs-virtual-servers-choice-right/>bare<br>metal</a>.</li></ul><h3 id=linux>Linux</h3><ul><li>Configure to <a href=http://www.makelinux.net/books/lkd2/ch15lev1sec4>maximize memory<br>usage</a> (tweak until you feel comfortable):</li></ul><pre tabindex=0><code>vm.dirty_background_ratio = 5
vm.dirty_ratio = 80
vm.swappiness = 1
</code></pre><ul><li>Assuming you are using <em>ext4</em>, don’t waste space with reserved blocks:</li></ul><pre tabindex=0><code>tune2fs -m 0 -i 0 -c -1 /dev/device
</code></pre><ul><li>Mount with <em>noatime</em>:</li></ul><pre tabindex=0><code>/dev/device       /mountpoint       ext4    defaults,noatime
</code></pre><ul><li>Keep an eye on the number of free <em>inodes</em>:</li></ul><pre tabindex=0><code>tune2fs -l /dev/device | grep -i inode
</code></pre><ul><li>Increase limits, for example, using <em>systemd</em>:</li></ul><pre tabindex=0><code>$ cat /etc/systemd/system/kafka.service.d/limits.conf
[Service]
LimitNOFILE=10000
</code></pre><ul><li>Tweak your network settings, for example:</li></ul><pre tabindex=0><code>net.core.somaxconn = 1024
net.core.rmem_max = 67108864
net.core.wmem_max = 67108864
net.ipv4.tcp_rmem = 4096 87380 33554432
net.ipv4.tcp_wmem = 4096 65536 33554432
net.ipv4.tcp_max_syn_backlog = 4096
net.ipv4.tcp_syncookies = 1
</code></pre><h3 id=kafka>Kafka</h3><ul><li><em>log.dirs</em> accepts a comma separated list of disks and will distribute<br>partitions across them, however:</li></ul><ol><li>Doesn’t rebalance, some disks could be full and others empty.</li><li>Doesn’t tolerate any disk failure, more info in<br><a href=https://cwiki.apache.org/confluence/display/KAFKA/KIP-18+-+JBOD+Support>KIP-18</a>.</li><li><em>Raid 10</em> is probably the best middle ground between performance and<br>reliability.</li></ol><ul><li>*num.io.threads, *number of I/O threads that the server uses for executing<br>requests. You should have at least as many threads as you have disks.</li><li><em>num.network.threads</em>, number of network threads that the server uses for<br>handling network requests. Increase based on number of producers/consumers and<br>replication factor.</li><li>Use Java 1.8 and <a href=http://www.oracle.com/technetwork/articles/java/g1gc-1984535.html>G1 Garbage<br>collector</a>:</li></ul><pre tabindex=0><code>-XX:MetaspaceSize=96m
-XX:+UseG1GC            # use G1
-XX:MaxGCPauseMillis=20 # gc deadline
-XX:InitiatingHeapOccupancyPercent=35
-XX:G1HeapRegionSize=16M
-XX:MinMetaspaceFreeRatio=50 -XX:MaxMetaspaceFreeRatio=80
</code></pre><ul><li><em>KAFKA_HEAP_OPTS</em>, 5–8Gb heap should be enough for most deployments, file system<br>cache is way more important. <em>Linkedin</em> runs <a href=http://docs.confluent.io/1.0/kafka/deployment.html>5Gb heap in 32Gb RAM<br>servers</a>.</li><li><a href=https://github.com/tobert/pcstat>pcstat</a> can help understand how well the<br>system is caching:</li></ul><pre tabindex=0><code>./pcstat /kafka/data/*
</code></pre><hr><p>Any comments or suggestions are welcome!</p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2016/08/stability-patterns-circuit-breaker/>Stability Patterns — Circuit Breaker</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2016-08-20>August 20, 2016</time></span></div><p class=post-summary><blockquote><p>A circuit breaker is an automatically operated electrical switch designed to<br>protect an electrical circuit from damage caused by over-current or overload or<br>short circuit. Its basic function is to interrupt current flow after protective<br>relays detect a fault. A circuit breaker can be reset (either manually or<br>automatically) to resume normal operation.</p></blockquote><p>The software analogue as described in <a href=https://pragprog.com/book/mnee/release-it>Release<br>it!</a> chapter 5.2 can prevent repeated<br>calls to a failing service by detecting issues and providing a fallback, by<br>using this pattern it is possible to avoid cascading failures.</p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2016/08/ansible-vs-pci/>Ansible vs PCI</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2016-08-16>August 16, 2016</time></span></div><p class=post-summary><p>If you need to comply with <a href=https://www.pcisecuritystandards.org/documents/PCIDSS_QRGv3_1.pdf>PCI<br>requirements</a><br>like:</p><blockquote><p><em>Requirement 2: Maintain an inventory of system components in scope for PCI DSS<br>to support effective scoping practices.</em></p></blockquote><p>You will find that using public-key authentication is sometimes<br><a href=https://security.stackexchange.com/questions/47213/pci-dss-2-0-and-ssh-keys>forbidden</a><br>as it’s almost impossible to ensure employees are rotating the keys, keeping the<br>private key safe and with a strong password.</p><p>Using <em>Ansible</em> without ssh key based authentication is painful if you need to<br>run a playbook against hundreds of servers, as you will need to insert your<br>password <em>ad nauseam</em>.</p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2016/08/docker-configuration-files/>Docker: Configuration files</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2016-08-14>August 14, 2016</time></span></div><p class=post-summary><h2 id=things-no-one-tells-you-about>Things no one tells you about.</h2><p>One of <a href=https://www.docker.com/>Docker</a>’s killer features is the environment<br>parity, yet it feels like one little detail was left untold: <strong>how to handle<br>configuration files</strong>.</p><p>Unless you are using the same configuration between <em>development</em>, <em>quality</em>,<br><em>production</em>, <em>etc</em>. you will end up with different endpoints, API keys, secret<br>tokens and feature switches for each environment.</p><h3 id=available-options>Available Options</h3><p>There are a couple of different ways to handle configuration in <em>Docker.</em> Below,<br>you will find a non-exhaustive list.</p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2016/08/collectd-plugins-made-easy/>Collectd plugins made easy</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2016-08-09>August 9, 2016</time></span></div><p class=post-summary><blockquote><p><strong>Collectd</strong> is a Unix daemon that collects, transfers and stores performance<br>data of computers and network equipment. The acquired data is meant to help<br>system administrators maintain an overview over available resources to detect<br>existing or looming bottlenecks.</p></blockquote><p><a href=https://collectd.org/>Collectd</a> provides a <a href=https://collectd.org/wiki/index.php/Table_of_Plugins>long list of<br>plugins</a> available<br>out-of-box. However, if you need to collect additional metrics, one of the<br>easiest ways to do so is using the <a href=https://collectd.org/wiki/index.php/Plugin:Exec>exec<br>plugin</a>.</p><p>In order to use the exec plugin, create an <em>Collectd</em> configuration file:</p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2016/07/chef-custom-resources/>Chef Custom Resources</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2016-07-13>July 13, 2016</time></span></div><p class=post-summary><p>Lately I’ve been writing some <em>Chef</em> code. One of the best things about <em>Chef</em><br>is custom resources:<br><a href=https://docs.chef.io/custom_resources.html>https://docs.chef.io/custom_resources.html</a></p><p>Let’s see an example on how to create a <a href=https://kafka.apache.org/>Kafka</a> topic<br>using <em>Chef</em> and how to make it<br><a href=https://en.wikipedia.org/wiki/Idempotence>idempotent</a>.</p><p>Before writing any <em>Chef</em> code it is important to understand how to manage a<br><em>topic</em> (grouping of messages of a similar type).</p><p>From the <em>Kafka</em> install directory, first check if the <em>topic</em> already exists:</p><pre tabindex=0><code>bin/kafka-topics.sh
    --zookeeper localhost:2181 \
    --describe \
    --topic &lt;name&gt;
</code></pre><p>If it doesn&rsquo;t exist, create it:</p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2016/02/ansible-in-aws-lambda/>Ansible in AWS Lambda</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2016-02-18>February 18, 2016</time></span></div><p class=post-summary><p>Originally published at <a href=https://medium.com/@jacoelho/ansible-in-aws-lambda-980bb8b5791b>https://medium.com/@jacoelho/ansible-in-aws-lambda-980bb8b5791b</a></p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2015/11/secure-redis/>Secure Redis</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2015-11-18>November 18, 2015</time></span></div><p class=post-summary><p>Originally published at <a href=https://medium.com/@jacoelho/secure-redis-dff568ef0ea0>https://medium.com/@jacoelho/secure-redis-dff568ef0ea0</a></p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2015/06/docker-images/>Docker Images</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2015-06-01>June 1, 2015</time></span></div><p class=post-summary><p>Originally published at <a href=https://medium.com/@jacoelho/docker-images-f3c5a39baa65>https://medium.com/@jacoelho/docker-images-f3c5a39baa65</a></p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2015/05/locally-developing-microservices/>Locally Developing Microservices</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2015-05-25>May 25, 2015</time></span></div><p class=post-summary><p>Originally published at <a href=https://medium.com/@jacoelho/locally-developing-microservices-d06f3e384e>https://medium.com/@jacoelho/locally-developing-microservices-d06f3e384e</a></p></p></article><nav class=pagination><div class="pagination-item left"><a class=button href=https://www.jacoelho.com/blog/>← Newer posts</a></div><div class="pagination-item right"><span class="button button-disabled">Older posts →</span></div></nav></main></div></div><footer class=footer><div class=container><div class=footer-content><span>&copy; 2025 Jose Coelho</span></div></div></footer><script src=https://www.jacoelho.com/js/bundle.min.c687f63d8e204d7466c7c9609ec6f61b44c1217490b36198e5f77ee3befc11ea.js integrity="sha256-xof2PY4gTXRmx8lgnsb2G0TBIXSQs2GY5fd+4778Eeo=" crossorigin=anonymous></script></body></html>