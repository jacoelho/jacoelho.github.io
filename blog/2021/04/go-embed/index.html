<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="map[name:Jose Coelho]"><meta name=description content="Ramblings about software engineering"><meta name=keywords content="go,golang,kubernetes,ansible,chef,kafka,docker,containers"><link rel=canonical href=https://www.jacoelho.com/blog/2021/04/go-embed/><title>Go - Embed :: Posts</title><link rel=stylesheet href=https://www.jacoelho.com/css/main.min.6f3353616359b0fe4cfe1d29dc41b46980dd1459838e2e6175f34881197cc945.css integrity="sha256-bzNTYWNZsP5M/h0p3EG0aYDdFFmDji5hdfNIgRl8yUU=" crossorigin=anonymous><meta itemprop=name content="Go - Embed"><meta itemprop=description content='Go 1.16 added a new embed package.
While the idea is not a novelty, there were already some packages with slightly different APIs fulfilling similar roles, for example:
go-bindata go-rice Having an official package is always a welcome addition to the batteries-included standard library.
Usage A possible way to embed react assets could be as simple as:
package web import ( "embed" "io/fs" ) //go:embed build/* var content embed.FS And serving assets using http.FileServer:'><meta itemprop=datePublished content="2021-04-27T10:00:00+00:00"><meta itemprop=dateModified content="2021-04-27T10:00:00+00:00"><meta itemprop=wordCount content="282"><meta itemprop=keywords content="Go,Golang,Embed"><meta property="og:url" content="https://www.jacoelho.com/blog/2021/04/go-embed/"><meta property="og:site_name" content="Posts"><meta property="og:title" content="Go - Embed"><meta property="og:description" content='Go 1.16 added a new embed package.
While the idea is not a novelty, there were already some packages with slightly different APIs fulfilling similar roles, for example:
go-bindata go-rice Having an official package is always a welcome addition to the batteries-included standard library.
Usage A possible way to embed react assets could be as simple as:
package web import ( "embed" "io/fs" ) //go:embed build/* var content embed.FS And serving assets using http.FileServer:'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-04-27T10:00:00+00:00"><meta property="article:modified_time" content="2021-04-27T10:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go - Embed"><meta name=twitter:description content='Go 1.16 added a new embed package.
While the idea is not a novelty, there were already some packages with slightly different APIs fulfilling similar roles, for example:
go-bindata go-rice Having an official package is always a welcome addition to the batteries-included standard library.
Usage A possible way to embed react assets could be as simple as:
package web import ( "embed" "io/fs" ) //go:embed build/* var content embed.FS And serving assets using http.FileServer:'><meta property="article:published_time" content="2021-04-27 10:00:00 +0000 UTC"><meta property="article:section" content="go"><meta property="article:section" content="golang"><meta property="article:section" content="embed"></head><body><header class=header><div class=container><div class=header-inner><a href=https://www.jacoelho.com/ class=logo>Jose Coelho</a><nav class=nav><button class=menu-trigger aria-label="Toggle menu" aria-expanded=false>
<svg width="24" height="24"><use href="https://www.jacoelho.com/icons.svg#menu"/></svg></button><div class=nav-menu><ul class=menu><li class=menu-item><a href=https://www.jacoelho.com/about/>About</a></li></ul><button class=theme-toggle aria-label="Toggle theme">
<svg class="theme-icon-light" width="20" height="20"><use href="https://www.jacoelho.com/icons.svg#sun"/></svg>
<svg class="theme-icon-dark" width="20" height="20"><use href="https://www.jacoelho.com/icons.svg#moon"/></svg>
</button>
<a href=https://www.jacoelho.com/index.xml class=rss-link target=_blank rel=noopener aria-label=RSS><svg width="20" height="20"><use href="https://www.jacoelho.com/icons.svg#rss"/></svg></a></div></nav></div></div></header><div class=container><div class=content><main class=post><article><header class=post-header><h1 class=post-title>Go - Embed</h1></header><div class=post-content><p>Go 1.16 added a new <a href=https://golang.org/pkg/embed/>embed</a> package.</p><p>While the idea is not a novelty, there were already some packages with slightly different APIs fulfilling similar roles, for example:</p><ul><li><a href=https://github.com/kevinburke/go-bindata>go-bindata</a></li><li><a href=https://github.com/GeertJohan/go.rice>go-rice</a></li></ul><p>Having an official package is always a welcome addition to the batteries-included standard library.</p><h2 id=usage>Usage</h2><p>A possible way to embed react assets could be as simple as:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;embed&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;io/fs&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>//go:embed build/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=nx>embed</span><span class=p>.</span><span class=nx>FS</span><span class=w>
</span></span></span></code></pre></div><p>And serving assets using <code>http.FileServer</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>http</span><span class=p>.</span><span class=nf>Handle</span><span class=p>(</span><span class=s>&#34;/static/&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nf>FileServer</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>FS</span><span class=p>(</span><span class=nx>content</span><span class=p>)))</span><span class=w>
</span></span></span></code></pre></div><p>However, following this structure, one may end up with some unexpected 404 responses.</p><h2 id=exploring-embed>Exploring Embed</h2><p>Fortunately, <code>go list</code> gained some new fields we can use to understand how embed works.</p><p><code>.EmbedPatterns</code> displays patterns being used:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go list -f <span class=s1>&#39;{{ join .EmbedPatterns &#34;\n&#34; }}&#39;</span> ./...
</span></span><span class=line><span class=cl>build/*
</span></span></code></pre></div><p>It can even detect if a pattern is not matching any resources:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go list -f <span class=s1>&#39;{{ join .EmbedPatterns &#34;\n&#34; }}&#39;</span> ./...
</span></span><span class=line><span class=cl>client/client.go:10:20: pattern foobar/*: no matching files found
</span></span></code></pre></div><p>Another addition to <code>go list</code> is allowing to list embed files:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go list -f <span class=s1>&#39;{{ join .EmbedFiles &#34;\n&#34; }}&#39;</span> ./...
</span></span><span class=line><span class=cl>build/favicon.ico
</span></span><span class=line><span class=cl>build/index.html
</span></span><span class=line><span class=cl>build/logo512.png
</span></span><span class=line><span class=cl>build/robots.txt
</span></span><span class=line><span class=cl>build/static/css/main.6dea0f05.chunk.css
</span></span><span class=line><span class=cl>build/static/js/2.6071c2c3.chunk.js
</span></span></code></pre></div><p>In this case, we can observe using the directive <code>//go:embed build/*</code> will include the <code>build</code> directory and all files in the directory.</p><p>If the files being served are not expecting to be in <code>build</code> directory it is possible to change the subtree:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Contents helper function</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>Contents</span><span class=p>()</span><span class=w> </span><span class=p>(</span><span class=nx>fs</span><span class=p>.</span><span class=nx>FS</span><span class=p>,</span><span class=w> </span><span class=kt>error</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>fs</span><span class=p>.</span><span class=nf>Sub</span><span class=p>(</span><span class=nx>content</span><span class=p>,</span><span class=w> </span><span class=s>&#34;build&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><hr><p>Embed package seems an exciting addition to the Go standard library.</p><p>I am curious to see which uses cases are possible. For now, I am expecting it to become the <em>de facto</em> solution to store database migration scripts and assets in low traffic apps.<br><br><br><br>Example code is available in <a href=https://github.com/jacoelho/sample-go-react>https://github.com/jacoelho/sample-go-react</a></p></div></article></main></div></div><footer class=footer><div class=container><div class=footer-content><span>&copy; 2025 Jose Coelho</span></div></div></footer><script src=https://www.jacoelho.com/js/bundle.min.c687f63d8e204d7466c7c9609ec6f61b44c1217490b36198e5f77ee3befc11ea.js integrity="sha256-xof2PY4gTXRmx8lgnsb2G0TBIXSQs2GY5fd+4778Eeo=" crossorigin=anonymous></script></body></html>