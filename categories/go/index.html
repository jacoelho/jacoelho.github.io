<!doctype html><html lang=en><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="map[name:Jose Coelho]"><meta name=description content="Ramblings about software engineering"><meta name=keywords content="go,golang,kubernetes,ansible,chef,kafka,docker,containers"><link rel=canonical href=https://www.jacoelho.com/categories/go/><title>Go :: Posts</title><link rel=stylesheet href=https://www.jacoelho.com/css/main.min.6f3353616359b0fe4cfe1d29dc41b46980dd1459838e2e6175f34881197cc945.css integrity="sha256-bzNTYWNZsP5M/h0p3EG0aYDdFFmDji5hdfNIgRl8yUU=" crossorigin=anonymous><link rel=alternate type=application/rss+xml href=https://www.jacoelho.com/categories/go/index.xml title=Posts><meta itemprop=name content="Go"><meta itemprop=description content="Ramblings about software engineering"><meta itemprop=datePublished content="2025-05-11T10:00:00+00:00"><meta itemprop=dateModified content="2025-05-11T10:00:00+00:00"><meta property="og:url" content="https://www.jacoelho.com/categories/go/"><meta property="og:site_name" content="Posts"><meta property="og:title" content="Go"><meta property="og:description" content="Ramblings about software engineering"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go"><meta name=twitter:description content="Ramblings about software engineering"></head><body><header class=header><div class=container><div class=header-inner><a href=https://www.jacoelho.com/ class=logo>Jose Coelho</a><nav class=nav><button class=menu-trigger aria-label="Toggle menu" aria-expanded=false>
<svg width="24" height="24"><use href="https://www.jacoelho.com/icons.svg#menu"/></svg></button><div class=nav-menu><ul class=menu><li class=menu-item><a href=https://www.jacoelho.com/about/>About</a></li></ul><button class=theme-toggle aria-label="Toggle theme">
<svg class="theme-icon-light" width="20" height="20"><use href="https://www.jacoelho.com/icons.svg#sun"/></svg>
<svg class="theme-icon-dark" width="20" height="20"><use href="https://www.jacoelho.com/icons.svg#moon"/></svg>
</button>
<a href=https://www.jacoelho.com/index.xml class=rss-link target=_blank rel=noopener aria-label=RSS><svg width="20" height="20"><use href="https://www.jacoelho.com/icons.svg#rss"/></svg></a></div></nav></div></div></header><div class=container><div class=content><main class=posts><h1>Go</h1><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2025/05/dependency-lifecycle-management-in-go/>Dependency Lifecycle Management in Go</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2025-05-11>May 11, 2025</time></span></div><p class=post-summary><h2 id=introduction>Introduction</h2><p>Lifecycle management ensures that application components like servers, databases, and background workers are correctly initialized, started in the right order, and gracefully stopped.</p><p>Go developers typically wire dependencies manually, instead of relying on heavy frameworks or reflection based dependency injection. This approach improves readability and reduces hidden behavior, but it also shifts the burden of managing component interactions and lifecycle sequencing onto the developer.</p><p>As applications scale, the lack of built-in orchestration increases the risk of subtle bugs and inconsistent shutdown behavior.</p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2023/09/structured-logging-slog/>structured logging: slog</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2023-09-11>September 11, 2023</time></span></div><p class=post-summary><p>Event logging is one of the three pillars of observability (traces and metrics being the other two).</p><p>A log entry is a timestamped record about the application&rsquo;s activity, which can be used for troubleshooting, monitoring or auditing purposes.</p><p>Logs may have different formats:</p><ul><li>unstructured or plain text: similar to print statements, free-form text</li><li>semi-structured: some values have a structure and the remaining data free-form</li><li>structured: there is a well-defined and consistent format, such as: <a href=https://www.w3.org/TR/WD-logfile.html>W3C Log Format</a>, <a href=https://en.wikipedia.org/wiki/Common_Log_Format>NCSA Log Format</a>, Key/Value Pair, CSV or JSON, among others. Structured logs can be easily machine parsed, which simplifies analytics, filtering and aggregation.</li></ul><p>This article is a non-exhaustive walkthrough of logging in Go.</p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2022/05/opentelemetry-log-based-change-data-capture-tracing/>Opentelemetry - Log-Based Change Data Capture tracing</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2022-05-02>May 2, 2022</time></span></div><p class=post-summary><p><a href=https://opentelemetry.io/>Opentelemetry</a> provides vendor neutral standards and implementations to generate, collect, and export tracing data.</p><p>A Context is a propagation mechanism which carries execution-scoped values across API boundaries and between logically associated execution units. Cross-cutting concerns access their data in-process using the same shared Context object.</p><p>Context propagation is required when the tracing needs to cross process or service boundaries. Common ways to propagate the context is using <a href=https://www.w3.org/TR/trace-context/>W3C Trace Context</a> or <a href=https://github.com/openzipkin/b3-propagation>Zipkin B3 headers</a>, while to inject the context is, for example, http headers or metadata fields in event messages.</p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2021/11/go-generic-programming-testing-the-waters/>Go Generic Programming - Testing the waters</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2021-11-29>November 29, 2021</time></span></div><p class=post-summary><p>Go <a href=https://go.googlesource.com/proposal/+/refs/heads/master/design/43651-type-parameters.md>Type Parameters Proposal</a> is expected to be implemented with Go 1.18 early 2022.</p><p>The <code>Very high level overview</code> section contains a nice overview of what to expect.</p><p>If you have seen generics in other languages perhaps the most curious differences (other than using square brackets), are union types:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>SignedIntegers</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=kt>int</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=kt>int8</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=kt>int16</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=kt>int32</span><span class=w> </span><span class=p>|</span><span class=w> </span><span class=kt>int64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Similar in syntax to scala3/dotty union types, although in Go is only allowed in constraints. The type set of this union element is the set {int, int8, int16, int32, int64}.</p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2021/06/go-on-logging-and-dependencies/>Go - On logging and dependencies</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2021-06-08>June 8, 2021</time></span></div><p class=post-summary><p>Doing code reviews, I have sometimes noticed libraries forcing dependencies on the users.</p><p>While it is perfectly acceptable if well justified and documented, it sometimes feels like adding unnecessary baggage.</p><p>A typical example would be something like the following snippet:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>Client</span><span class=p>)</span><span class=w> </span><span class=nf>HealthCheck</span><span class=p>(</span><span class=nx>ctx</span><span class=w> </span><span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=kt>error</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>logrus</span><span class=p>.</span><span class=nf>Debug</span><span class=p>(</span><span class=s>&#34;sending get request&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nf>NewRequestWithContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nx>MethodGet</span><span class=p>,</span><span class=w> </span><span class=nx>c</span><span class=p>.</span><span class=nx>url</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>resp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>c</span><span class=p>.</span><span class=nx>client</span><span class=p>.</span><span class=nf>Do</span><span class=p>(</span><span class=nx>req</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nx>err</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>logrus</span><span class=p>.</span><span class=nf>Debugf</span><span class=p>(</span><span class=s>&#34;http status code was %d&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>resp</span><span class=p>.</span><span class=nx>StatusCode</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>defer</span><span class=w> </span><span class=nx>resp</span><span class=p>.</span><span class=nx>Body</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>nil</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Using logrus, as example, picking this code, one would need to check how logrus works, which configurations are available, which version should be used and so on.</p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2021/06/postgresql-uuid-vs-text/>PostgreSQL - UUID vs TEXT</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2021-06-05>June 5, 2021</time></span></div><p class=post-summary><p>In PostgreSQL one can represent <a href=https://en.wikipedia.org/wiki/Universally_unique_identifier>UUID</a> as <code>UUID</code>, <code>TEXT</code> or <code>VARCHAR</code> built-in types.</p><h3 id=which-type-represents-a-uuid-more-efficiently-mainly-in-the-jsonb-context>Which type represents a UUID more efficiently? Mainly in the JSONB context?</h3><p>My gut feeling says built-in type <code>UUID</code> is way better.</p><p>One trap with using <code>TEXT</code> is trying to compare different cases with equals:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=s1>&#39;ef9f94da-98ef-49fa-8224-32f3e1f592b3&#39;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;EF9F94DA-98EF-49FA-8224-32F3E1F592B3&#39;</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>equal</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=n>equal</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w> </span><span class=n>f</span><span class=w>
</span></span></span></code></pre></div><p>Checking the relevant <a href=https://datatracker.ietf.org/doc/html/rfc4122#section-3>RFC4122</a> section:</p><pre tabindex=0><code>Each field is treated as an integer and has its value printed as a
zero-filled hexadecimal digit string with the most significant
digit first.  The hexadecimal values &#34;a&#34; through &#34;f&#34; are output as
lower case characters and are case insensitive on input.
</code></pre><p>Which the <code>UUID</code> type correctly handles:</p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2021/04/go-embed/>Go - Embed</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2021-04-27>April 27, 2021</time></span></div><p class=post-summary><p>Go 1.16 added a new <a href=https://golang.org/pkg/embed/>embed</a> package.</p><p>While the idea is not a novelty, there were already some packages with slightly different APIs fulfilling similar roles, for example:</p><ul><li><a href=https://github.com/kevinburke/go-bindata>go-bindata</a></li><li><a href=https://github.com/GeertJohan/go.rice>go-rice</a></li></ul><p>Having an official package is always a welcome addition to the batteries-included standard library.</p><h2 id=usage>Usage</h2><p>A possible way to embed react assets could be as simple as:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nx>web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;embed&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;io/fs&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>//go:embed build/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=nx>content</span><span class=w> </span><span class=nx>embed</span><span class=p>.</span><span class=nx>FS</span><span class=w>
</span></span></span></code></pre></div><p>And serving assets using <code>http.FileServer</code>:</p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2021/04/go-on-building-url-strings/>Go - On building URL strings</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2021-04-17>April 17, 2021</time></span></div><p class=post-summary><p>Building URL strings in Go may be accomplished in a couple different ways:</p><ul><li><code>url.Parse</code></li><li>string concatenation (using <code>+</code>)</li><li><code>fmt.Sprintf</code></li><li><code>bytes.Buffer</code></li><li><code>strings.Builder</code></li></ul><p>You may be asking yourself: which one should I use, then? As always, the answer depends. Let us explore why.</p><h2 id=urlparse><code>URL.Parse</code></h2><p>Before we start, a quick refresh on the URL structure:</p><p><img src=https://www.jacoelho.com/images/url.png alt=url></p><p>One important fact to be aware is that when building URLs manually, it is easy to forget the <a href=https://en.wikipedia.org/wiki/Percent-encoding>percentage-encoding</a>.</p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2020/09/writing-a-client-library-in-go/>Writing a client library in Go</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2020-09-25>September 25, 2020</time></span></div><p class=post-summary><p>There are multiple ways of writing client libraries in Go. In this post, I will explore what I look for in a library depending if I am developing or checking if it is suitable for a project.</p><p>Without any specific order of importance, these are my thoughts on the subject.</p><h2 id=usage-and-examples>Usage and Examples</h2><p>Like a book can be judged by its cover, a project can be judged by its README. Therefore providing examples helps getting an idea of how the library works: if it will fit a project or how good the developer usability is (this includes function naming, usage difficulty or how easy it is to misuse).</p></p></article><article class=post-item><h2 class=post-title><a href=https://www.jacoelho.com/blog/2017/08/a-story-about-go-http.client/>A story about Go http.Client</a></h2><div class=post-meta><span class=post-meta-item><time datetime=2017-08-19>August 19, 2017</time></span></div><p class=post-summary><p>Or how I have learned to embrace <em>http.RoundTripper</em></p><p>Using a http client in <em>Go</em> usually starts like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>resp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;http://example.com/&#34;</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>Everything works, until it doesn’t: a network blip, a connection reset, a slow<br>response, etc.</p><p>After some research (I recommend reading <a href=https://blog.cloudflare.com/the-complete-guide-to-golang-net-http-timeouts/>The complete guide to Go net/http<br>timeouts</a>)<br>you may end up writing something similar to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>c</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>&amp;</span><span class=nx>http</span><span class=p>.</span><span class=nx>Client</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Transport</span><span class=p>:</span><span class=w> </span><span class=o>&amp;</span><span class=nx>http</span><span class=p>.</span><span class=nx>Transport</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>Dial</span><span class=p>:</span><span class=w> </span><span class=p>(</span><span class=o>&amp;</span><span class=nx>net</span><span class=p>.</span><span class=nx>Dialer</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>Timeout</span><span class=p>:</span><span class=w>   </span><span class=mi>30</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nx>KeepAlive</span><span class=p>:</span><span class=w> </span><span class=mi>30</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}).</span><span class=nx>Dial</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>TLSHandshakeTimeout</span><span class=p>:</span><span class=w>   </span><span class=mi>10</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>ResponseHeaderTimeout</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>ExpectContinueTimeout</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>_</span><span class=o>:=</span><span class=w> </span><span class=nx>http</span><span class=p>.</span><span class=nf>NewRequest</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>MethodGet</span><span class=p>,</span><span class=w> </span><span class=s>&#34;https://www.google.com&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>nil</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>resp</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>c</span><span class=p>.</span><span class=nf>Do</span><span class=p>(</span><span class=nx>req</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>Ok! But now the question is: how does <em>http.Client</em> really work?</p></p></article><nav class=pagination><div class="pagination-item left"><span class="button button-disabled">← Newer posts</span></div><div class="pagination-item right"><a class=button href=https://www.jacoelho.com/categories/go/page/2/>Older posts →</a></div></nav></main></div></div><footer class=footer><div class=container><div class=footer-content><span>&copy; 2025 Jose Coelho</span></div></div></footer><script src=https://www.jacoelho.com/js/bundle.min.c687f63d8e204d7466c7c9609ec6f61b44c1217490b36198e5f77ee3befc11ea.js integrity="sha256-xof2PY4gTXRmx8lgnsb2G0TBIXSQs2GY5fd+4778Eeo=" crossorigin=anonymous></script></body></html>